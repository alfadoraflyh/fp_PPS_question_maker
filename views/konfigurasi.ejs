<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <link rel="stylesheet" href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src="https://code.iconify.design/iconify-icon/1.0.3/iconify-icon.min.js"></script>
    
        <title>Bank Soal</title>
    </head>

    <nav class="navbar navbar-expand-sm bg-white navbar-light justify-content-end">
        <button class="col-lg-2" style="padding-left: 100px;" onclick="location.href='/paketsoal'">
            <svg width="17" viewBox="0 0 47 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M46.68 7.08L39.6 0L0 39.6L39.6 79.2L46.68 72.12L14.16 39.6L46.68 7.08Z" fill="black"/>
            </svg>   
        </button>
        <div class="col-lg-8"></div>
        <div class="col-lg-2">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="#">Dosen Pengampu</a>
          </li>
          <li class="nav-item">
            <iconify-icon icon="gridicons:user-circle" style="color:#666;" width="35" height="35"></iconify-icon>
          </li>  
        </ul>
        </div>
    </nav>

    <body style="background-color: #1f2122; padding-bottom: 20px">
        <div class="container" style="margin-top: 30px;">
            <div class="row pt-3 text-xs font-bold">
                <div class="col-lg-12">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-lg-9">
                    <h4 style="color: white;">Edit Konfigurasi Paket Soal</h4>           
                </div>
                <div class="col-lg-3">
                </div>
            </div>
            <div class="row mb-10" style="width: 100%;">
                <div class="col-lg-12 pt-3" style="background-color:  #27292a; border-radius: 20px;">
                    <div id="messagePaketSoal">
                        <form id="formPaketSoal" method="post", action="/konfigurasi/<%= paketsoal.id_paket_soal %>">
                            <div class="row px-4">
                                <div class="col-lg-7 form-group">
                                    <label style="color: white;" for="nama_paket_soal" class="font-bold">Nama Paket Soal : </label>
                                    <input type="text" class="form-control" name="nama_paket_soal" id="nama_paket_soal" value="<%= paketsoal.nama_paket_soal %>">
                                </div>
                                <div class="col-lg-3 form-group">
                                    <label style="color: white;" for="jumlah_soal" class="font-bold">Jumlah Soal :</label>
                                    <input type="number" class="form-control" name="jumlah_soal" id="jumlah_soal" value="<%= paketsoal.jumlah_soal %>">
                                </div>
                                <div class="col-lg-2">
                                    <button class="btn btn-block btn-secondary float-right mt-8" type="submit">
                                        Simpan <iconify-icon icon="bxs:save" style="color: white;" width="16" height="16"></iconify-icon>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="row-mb-10" style="width: 100%;">
                <div class="col-lg-12 pt-3" style="background-color: #27292a; border-radius: 20px; padding-bottom: 8px;">
                    <div id="messageTopikUjian">
                        <form id="postTopikUjian" method="post", action="/topikujian">
                            <div class="row">
                                <div class="col-lg-3 form-group">
                                    <label style="color: white;" for="id_topik" class="font-bold">Topik Ujian :</label>
                                    <select class="form-control" name="id_topik" id="id_topik">
                                        <% topik.forEach(function(t){ %>
                                            <option value="<%= t.id_topik %>"><%= t.nama_topik %></option>
                                        <% }); %>
                                    </select>
                                </div>
                                <div class="col-lg-2 form-group">
                                    <label style="color: white;" for="persentase_topik" class="font-bold">Persentase Topik :</label>
                                    <input type="number" class="form-control" name="persentase_topik" id="persentase_topik" min="0" max="1" step="0.1" placeholder="0.0 - 1.0">
                                </div>
                                <div class="col-lg-2 form-group">
                                    <label style="color: white;" for="persentase_mudah" class="font-bold">% Soal Mudah :</label>
                                    <input type="number" class="form-control" name="persentase_mudah" id="persentase_mudah" min="0" max="1" step="0.1" placeholder="0.0 - 1.0">
                                </div>
                                <div class="col-lg-2 form-group">
                                    <label style="color: white;" for="persentase_sedang" class="font-bold">% Soal Sedang :</label>
                                    <input type="number" class="form-control" name="persentase_sedang" id="persentase_sedang" min="0" max="1" step="0.1" placeholder="0.0 - 1.0">
                                </div>
                                <div class="col-lg-2 form-group">
                                    <label style="color: white;" for="persentase_sulit" class="font-bold">% Soal Sulit :</label>
                                    <input type="number" class="form-control" name="persentase_sulit" id="persentase_sulit" min="0" max="1" step="0.1" placeholder="0.0 - 1.0">
                                </div>
                                <div class="col-lg-1 pt-8">
                                    <input type="hidden" name="id_paket_soal" id="id_paket_soal" value="<%= paketsoal.id_paket_soal %>">
                                    <button class="btn btn-secondary float-right" style="width: 60px;" type="submit">
                                        <iconify-icon icon="gg:add" style="color: white;" width="20" height="20px"></iconify-icon>
                                    </button>
                                </div>
                            </div>
                        </form>
                        <div class="row">
                            <div class="col-sm-12" style="background-color: #27292a; border-radius: 20px; height: 250px; margin-top: -20px; padding-left: 5px; padding-right: 5px;">
                                <div class="h-100 overflow-auto px-2 pt-2">
                                    <% topikujian.forEach(function(tu){ %>
                                        <div class="input-group">   
                                            <div class="form-control" style="width: 200px;"><strong><%= tu.nama_topik %></strong></div>
                                            <div class="form-control "><strong><%= tu.persentase_topik %></strong></div>
                                            <div class="form-control"><strong><%= tu.persentase_mudah %></strong></div>
                                            <div class="form-control"><strong><%= tu.persentase_sedang %></strong></div>
                                            <div class="form-control"><strong><%= tu.persentase_sulit %></strong></div>
                                            <div class="input-group-append">
                                                <form class="deleteTopikUjian" style="display:inline-block;">
                                                    <input type="hidden" class="id_topik_ujian" name="id_topik_ujian" value="<%= tu.id_topik_ujian %>">
                                                    <button class="btn btn-outline-danger btn-sm" type="submit">
                                                        <iconify-icon icon="mdi:cancel-bold" style="color: rgb(86, 86, 86);" width="24" height="24"></iconify-icon>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    <% }); %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-center" style="margin-top: 20px;">
            <div class="d-flex justify-content-center">
                <form id="submitPaketSoal" class="submitPaketSoal" style="display:inline-block;">
                    <button class="btn btn-secondary btn-large" type="submit">
                        Buat Paket Soal<iconify-icon style="color: white;"></iconify-icon>
                     </button>
                </form>   
            </div>
        </div>        
        <script>
            const messagePaketSoal = document.getElementById('messagePaketSoal')
            const formPaketSoal = document.getElementById('formPaketSoal')
            const messageTopikUjian = document.getElementById('messageTopikUjian');
            const postTopikUjian = document.getElementById('postTopikUjian');
            const deleteTopikUjianForms = document.querySelectorAll('.deleteTopikUjian');
           
            document.getElementById("nama_paket_soal").addEventListener("input", function() {
            this.setAttribute('value', this.value);
            console.log(this.value);
            });

            document.getElementById("jumlah_soal").addEventListener("input", function() {
            this.setAttribute('value', this.value);
            console.log(this.value);
            });

            document.getElementById("submitPaketSoal").addEventListener("submit", function(event) {
            event.preventDefault();
            fetch('/api/paketsoal/<%= paketsoal.id_paket_soal %>', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                window.location.href = "/paketsoal/<%= paketsoal.id_paket_soal %>"; // Redirect to the "/paketsoal/id" page
            })
            .catch((error) => {
                console.error('Error:', error);
            });
            });


            formPaketSoal.addEventListener('submit', function (e) {
            e.preventDefault();
            const url = `http://localhost:3000/api/konfigurasi/<%= paketsoal.id_paket_soal %>`

            let data = {
                nama_paket_soal: document.getElementById('nama_paket_soal').value,
                jumlah_soal: document.getElementById('jumlah_soal').value
            };

            fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                    if (response.status === 200) { // HTTP status code for a successful PUT request is 200
                        location.reload()
                    } else {
                        messagePaketSoal.textContent = 'Paket soal tidak berhasil diperbarui!';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    messagePaketSoal.textContent = 'An error occurred while updating the record.';
                });
            });

            postTopikUjian.addEventListener('submit', function (e) {
            e.preventDefault();
            const url = `http://localhost:3000/api/topikujian`;

            let data = {
                id_paket_soal: parseInt(document.getElementById('id_paket_soal').value),
                id_topik: document.getElementById('id_topik').value,
                persentase_topik: document.getElementById('persentase_topik').value,
                persentase_mudah: document.getElementById('persentase_mudah').value,
                persentase_sedang: document.getElementById('persentase_sedang').value,
                persentase_sulit: document.getElementById('persentase_sulit').value
            };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.status === 201) {
                    location.reload();
                } else {
                    messageTopikUjian.textContent = 'Topik Ujian tidak berhasil ditambahkan!';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                messageTopikUjian.textContent = 'An error occurred while inserting the record.';
            });
            });

            deleteTopikUjianForms.forEach(function(form) {
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                const id = form.querySelector('.id_topik_ujian').value;
                const url = `http://localhost:3000/api/topikujian/${id}`;

                fetch(url, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (response.status === 200) {
                        location.reload();
                    } else {
                        messageTopikUjian.textContent = 'Topik Ujian tidak berhasil dihapus!';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    messageTopikUjian.textContent = 'An error occurred while deleting the record.';
                });
            });
            });
        
        </script>
    </body>
</html>